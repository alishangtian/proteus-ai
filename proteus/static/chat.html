<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¢é—®ä»»ä½•é—®é¢˜</title>
    <link rel="icon" type="image/svg+xml" href="/static/icon/proteus.png">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/highlightjs/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="/static/card-styles.css">
    <!-- KaTeX CSS for math rendering -->
    <link rel="stylesheet" href="/static/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script src="/static/highlightjs/highlight.min.js"></script>
    <script src="/static/marked.min.js"></script>
    <!-- KaTeX JS for math rendering -->
    <script defer src="/static/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <!-- KaTeX auto-render extension -->
    <script defer src="/static/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>
    <!-- Mermaid JS for diagram rendering -->
    <script src="/static/mermaid.min.js"></script>
    <script src="/static/html2canvas.min.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="/static/jspdf.umd.min.js"></script>
    <script src="/static/main.js" type="module"></script>
    <script src="/static/card-view.js"></script>
    <style>
        /* å›¾ç‰‡æŸ¥çœ‹å™¨æµ®æ¡†æ ·å¼ */
        .image-viewer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .image-viewer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .image-viewer-container {
            position: relative;
            max-width: 95vw;
            max-height: 95vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-viewer-content {
            position: relative;
            transform-origin: center center;
            cursor: grab;
            user-select: none;
        }

        .image-viewer-content:active {
            cursor: grabbing;
        }

        .image-viewer-content img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            background-color: #FFFFFF;
        }

        .image-viewer-content svg {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            background-color: #FFFFFF;
            display: block;
        }

        /* å›¾ç‰‡æŸ¥çœ‹å™¨å·¥å…·æ  */
        .image-viewer-toolbar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 10001;
        }

        .image-viewer-toolbar button {
            width: 40px;
            height: 40px;
            border: none;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #333;
        }

        .image-viewer-toolbar button:hover {
            background: #1677FF;
            color: #fff;
        }

        .image-viewer-toolbar button:active {
            transform: scale(0.95);
        }

        .image-viewer-toolbar .zoom-level {
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 14px;
            color: #666;
            font-family: 'Noto Sans SC', sans-serif;
            min-width: 60px;
            justify-content: center;
        }

        /* å…³é—­æŒ‰é’® */
        .image-viewer-close {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            transition: all 0.2s ease;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
        }

        .image-viewer-close:hover {
            background: #ff4d4f;
            color: #fff;
            transform: scale(1.1);
        }

        .image-viewer-close svg {
            width: 24px;
            height: 24px;
        }

        /* æç¤ºæ–‡å­— */
        .image-viewer-hint {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            border-radius: 6px;
            font-size: 13px;
            font-family: 'Noto Sans SC', sans-serif;
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-viewer-hint.show {
            opacity: 1;
        }
    </style>
</head>

<body>
    <!-- å·¦ä¾§è¾¹æ  -->
    <div class="sidebar left-sidebar" id="leftSidebar">
        <button class="sidebar-toggle" title="æ”¶èµ·ä¾§è¾¹æ ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
        </button>
        <div class="conversation-list-container">
            <div class="conversation-list-header">
                <h3>ä¼šè¯å†å²</h3>
                <button id="new-conversation-btn" class="new-conversation-btn" title="æ–°å»ºä¼šè¯">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
            <div id="conversation-list" class="conversation-list">
                <div class="conversation-list-loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- å·¦ä¾§åˆ†éš”çº¿ -->
    <div class="sidebar-resizer left-resizer" id="leftResizer"></div>

    <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <div class="content-wrapper">
            <div id="conversation-history"></div>
            <div class="input-container">
                <div id="uploaded-files-container" class="uploaded-files-container">
                    <!-- å·²ä¸Šä¼ æ–‡ä»¶å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                <div class="input-wrapper">
                    <div class="input-controls-left">
                        <button id="options-button" type="button" aria-label="é€‰é¡¹è®¾ç½®" class="options-button">
                            +
                        </button>
                    </div>
                    <textarea id="user-input" placeholder="è¯¢é—®ä»»ä½•é—®é¢˜ï¼Œåˆ›é€ ä»»ä½•äº‹ç‰©"></textarea>

                    <div class="input-controls" style="display:flex;gap:8px;align-items:center;">
                        <input type="file" id="file-upload" style="display: none;" multiple>
                        <button id="upload-button" type="button" aria-label="ä¸Šä¼ æ–‡ä»¶">
                            ğŸ“
                        </button>
                        <button id="send-button" type="button" aria-label="å‘é€">
                            å‘é€
                        </button>
                    </div>
                </div>

                <!-- é€‰é¡¹é¢æ¿ - ç‚¹å‡»+å·åå¼¹å‡º -->
                <div id="options-panel" class="options-panel" style="display: none;">
                    <div class="options-panel-content">
                        <!-- <div class="options-panel-header">
                            <button id="close-options-panel" type="button" aria-label="å…³é—­">&times;</button>
                        </div> -->
                        <div class="options-panel-body">
                            <div class="model-select-wrapper">
                                <label for="model-select"><span>ğŸ“š å·¥ä½œæ¨¡å¼</span></label>
                                <select id="model-select" class="select-control" aria-label="å·¥ä½œæ¨¡å¼" title="é€‰æ‹©å·¥ä½œæ¨¡å¼">
                                    <option value="chat" selected>æ™ºèƒ½åŠ©æ‰‹</option>
                                    <option value="deep-research">æ·±åº¦ç ”ç©¶</option>
                                    <option value="deep-research-multi">æ·±åº¦ç ”ç©¶-å¤šæ™ºèƒ½ä½“</option>
                                    <option value="super-agent">è¶…çº§æ™ºèƒ½ä½“</option>
                                    <option value="codeact-agent">CodeActæ™ºèƒ½ä½“</option>
                                    <option value="mcp-agent">MCPæ™ºèƒ½ä½“</option>
                                    <option value="browser-agent">Browseræ™ºèƒ½ä½“</option>
                                </select>
                            </div>
                            <div id="tool-call-container">
                                <div class="memory-wrapper">
                                    <label for="tool-call-toggle">
                                        <span>ğŸ”§ å·¥å…·è°ƒç”¨</span>
                                    </label>
                                    <input type="checkbox" id="tool-call-toggle" class="memory-toggle" checked
                                        title="æœç´¢ã€çˆ¬è™«å’Œä»£ç æ‰§è¡Œå™¨">
                                </div>
                            </div>
                            <div class="model-select-wrapper">
                                <label for="model-name-select"><span>ğŸ‘¨â€ğŸ”¬ æ¨¡å‹</span></label>
                                <select id="model-name-select" class="select-control" aria-label="æ¨¡å‹"
                                    title="é€‰æ‹©æ¨¡å‹"></select>
                            </div>

                            <div id="itecount-container" class="model-select-wrapper">
                                <label for="itecount"><span>ğŸ”„ è¿­ä»£è½®æ¬¡</span></label>
                                <input type="number" id="itecount" class="select-control" min="1" value="25"
                                    placeholder="è¿­ä»£è½®æ¬¡" />
                            </div>

                            <div id="conversation_count-container" class="model-select-wrapper">
                                <label for="conversation_count"><span>ğŸ’¬ ä¼šè¯è½®æ¬¡</span></label>
                                <input type="number" id="conversation_count" class="select-control" min="1" value="10"
                                    placeholder="ä¼šè¯è½®æ¬¡" />
                            </div>
                            <div class="memory-wrapper">
                                <label for="tool-memory-toggle">
                                    <span>ğŸ”§ å·¥å…·è®°å¿†</span>
                                </label>
                                <input type="checkbox" id="tool-memory-toggle" class="memory-toggle">
                            </div>

                            <div class="memory-wrapper">
                                <label for="sop-memory-toggle">
                                    <span>ğŸ“‹ SOPè®°å¿†</span>
                                </label>
                                <input type="checkbox" id="sop-memory-toggle" class="memory-toggle">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å³ä¾§åˆ†éš”çº¿ -->
    <div class="sidebar-resizer right-resizer" id="rightResizer"></div>

    <!-- å³ä¾§è¾¹æ  -->
    <div class="sidebar right-sidebar" id="rightSidebar">
        <button class="sidebar-toggle" title="æ”¶èµ·ä¾§è¾¹æ ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
            </svg>
        </button>
        <div class="playbook-container">
            <div id="playbook-content"></div>
        </div>
    </div>

    <!-- å·¥å…·ç»“æœå¼¹æ¡† -->
    <div id="toolResultModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å·¥å…·æ‰§è¡Œç»“æœ</h3>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-result-content"></div>
                <div class="modal-actions">
                    <button class="copy-btn" data-copy-target=".modal-result-content pre">
                        <svg class="copy-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path>
                            <path
                                d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z">
                            </path>
                        </svg>
                        <span class="copy-tooltip">å¤åˆ¶åŸå§‹ç»“æœ</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤ä¼šè¯å¼¹æ¡† -->
    <div id="deleteConversationModal" class="modal">
        <div class="modal-content modal-confirm">
            <div class="modal-header">
                <h3 class="modal-title">ç¡®è®¤åˆ é™¤</h3>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-message">ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¼šè¯å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-cancel">å–æ¶ˆ</button>
                    <button class="modal-btn modal-btn-confirm">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡/å›¾è¡¨æŸ¥çœ‹å™¨æµ®æ¡† -->
    <div class="image-viewer-overlay" id="image-viewer">
        <button class="image-viewer-close" id="viewer-close" title="å…³é—­ (Esc)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <div class="image-viewer-hint" id="viewer-hint">ä½¿ç”¨æ»šè½®ç¼©æ”¾ï¼Œæ‹–åŠ¨ç§»åŠ¨å›¾ç‰‡</div>
        <div class="image-viewer-container">
            <div class="image-viewer-content" id="viewer-content">
                <!-- å›¾ç‰‡/SVG å†…å®¹å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
            </div>
        </div>
        <div class="image-viewer-toolbar" id="viewer-toolbar">
            <button id="viewer-zoom-out" title="ç¼©å° (-)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>
            <button id="viewer-zoom-reset" title="é‡ç½®ç¼©æ”¾ (0)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </button>
            <span class="zoom-level" id="viewer-zoom-level">100%</span>
            <button id="viewer-zoom-in" title="æ”¾å¤§ (+)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="11" y1="8" x2="11" y2="14"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>
            <button id="viewer-download" title="ä¸‹è½½å›¾ç‰‡">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // å›¾ç‰‡æŸ¥çœ‹å™¨ç±»
        class ImageViewer {
            constructor() {
                this.overlay = document.getElementById('image-viewer');
                this.content = document.getElementById('viewer-content');
                this.zoomLevelDisplay = document.getElementById('viewer-zoom-level');
                this.hint = document.getElementById('viewer-hint');

                this.scale = 1;
                this.minScale = 0.1;
                this.maxScale = 5;
                this.translateX = 0;
                this.translateY = 0;
                this.isDragging = false;
                this.startX = 0;
                this.startY = 0;
                this.currentSvgContent = null;

                this.init();
            }

            init() {
                // å…³é—­æŒ‰é’®
                document.getElementById('viewer-close').addEventListener('click', () => this.close());

                // ç‚¹å‡»é®ç½©å…³é—­
                this.overlay.addEventListener('click', (e) => {
                    if (e.target === this.overlay) {
                        this.close();
                    }
                });

                // ç¼©æ”¾æŒ‰é’®
                document.getElementById('viewer-zoom-in').addEventListener('click', () => this.zoomIn());
                document.getElementById('viewer-zoom-out').addEventListener('click', () => this.zoomOut());
                document.getElementById('viewer-zoom-reset').addEventListener('click', () => this.resetZoom());

                // ä¸‹è½½æŒ‰é’®
                document.getElementById('viewer-download').addEventListener('click', () => this.download());

                // æ»šè½®ç¼©æ”¾
                this.content.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? -0.1 : 0.1;
                    this.zoom(delta, e.clientX, e.clientY);
                });

                // æ‹–åŠ¨åŠŸèƒ½
                this.content.addEventListener('mousedown', (e) => this.startDrag(e));
                document.addEventListener('mousemove', (e) => this.drag(e));
                document.addEventListener('mouseup', () => this.endDrag());

                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', (e) => {
                    if (!this.overlay.classList.contains('active')) return;

                    switch (e.key) {
                        case 'Escape':
                            this.close();
                            break;
                        case '+':
                        case '=':
                            this.zoomIn();
                            break;
                        case '-':
                            this.zoomOut();
                            break;
                        case '0':
                            this.resetZoom();
                            break;
                    }
                });
            }

            open(element) {
                // é‡ç½®çŠ¶æ€
                this.scale = 1;
                this.translateX = 0;
                this.translateY = 0;
                this.currentSvgContent = null;

                // å…‹éš†å†…å®¹
                if (element.tagName === 'IMG') {
                    const img = document.createElement('img');
                    img.src = element.src;
                    img.alt = element.alt || 'å›¾ç‰‡';
                    this.content.innerHTML = '';
                    this.content.appendChild(img);
                } else if (element.classList.contains('mermaid')) {
                    // Mermaid å›¾è¡¨ - å¤åˆ¶ SVG
                    const svg = element.querySelector('svg');
                    if (svg) {
                        // æ·±åº¦å…‹éš†SVGï¼ŒåŒ…æ‹¬æ‰€æœ‰å­å…ƒç´ å’Œå±æ€§
                        const clonedSvg = svg.cloneNode(true);

                        // è·å–æˆ–åˆ›å»ºviewBox
                        let viewBox = svg.getAttribute('viewBox');
                        if (!viewBox) {
                            // å°è¯•ä»å®½åº¦å’Œé«˜åº¦åˆ›å»ºviewBox
                            const width = svg.getAttribute('width');
                            const height = svg.getAttribute('height');
                            if (width && height) {
                                viewBox = `0 0 ${width} ${height}`;
                            } else {
                                // å¦‚æœéƒ½æ²¡æœ‰ï¼Œä½¿ç”¨é»˜è®¤viewBox
                                viewBox = '0 0 800 600';
                            }
                            clonedSvg.setAttribute('viewBox', viewBox);
                        }

                        // è®¾ç½®SVGçš„æ ·å¼ï¼Œä½¿å…¶è‡ªé€‚åº”å®¹å™¨
                        clonedSvg.style.width = '100%';
                        clonedSvg.style.height = '100%';
                        clonedSvg.style.maxWidth = '100%';
                        clonedSvg.style.maxHeight = '100%';
                        clonedSvg.style.display = 'block';

                        // è®¾ç½®ç™½è‰²èƒŒæ™¯ï¼Œè§£å†³é€æ˜èƒŒæ™¯å¯¼è‡´è¿çº¿çœ‹ä¸è§çš„é—®é¢˜
                        clonedSvg.style.backgroundColor = '#FFFFFF';

                        // ç¡®ä¿SVGå‘½åç©ºé—´æ­£ç¡®
                        if (!clonedSvg.getAttribute('xmlns')) {
                            clonedSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                        }

                        // æ¸…ç©ºå†…å®¹å¹¶æ·»åŠ å…‹éš†çš„SVG
                        this.content.innerHTML = '';
                        this.content.appendChild(clonedSvg);
                        this.currentSvgContent = svg.outerHTML;

                        // è®¾ç½®åˆå§‹ç¼©æ”¾ï¼Œä½¿SVGæ›´å¤§
                        this.scale = 4;
                        this.translateX = 0;
                        this.translateY = 0;
                    }
                }

                this.updateTransform();
                this.updateZoomDisplay();

                // æ˜¾ç¤ºæµ®æ¡†
                this.overlay.classList.add('active');
                document.body.style.overflow = 'hidden';

                // æ˜¾ç¤ºæ“ä½œæç¤º
                this.showHint();
            }

            close() {
                this.overlay.classList.remove('active');
                document.body.style.overflow = '';
                this.content.innerHTML = '';
            }

            zoom(delta, centerX = null, centerY = null) {
                const newScale = Math.max(this.minScale, Math.min(this.maxScale, this.scale + delta));

                if (centerX !== null && centerY !== null) {
                    // ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾
                    const rect = this.content.getBoundingClientRect();
                    const x = centerX - rect.left - rect.width / 2;
                    const y = centerY - rect.top - rect.height / 2;

                    const scaleRatio = newScale / this.scale;
                    this.translateX = this.translateX * scaleRatio - x * (scaleRatio - 1);
                    this.translateY = this.translateY * scaleRatio - y * (scaleRatio - 1);
                }

                this.scale = newScale;
                this.updateTransform();
                this.updateZoomDisplay();
            }

            zoomIn() {
                this.zoom(0.2);
            }

            zoomOut() {
                this.zoom(-0.2);
            }

            resetZoom() {
                this.scale = 1;
                this.translateX = 0;
                this.translateY = 0;
                this.updateTransform();
                this.updateZoomDisplay();
            }

            updateTransform() {
                this.content.style.transform = `translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`;
            }

            updateZoomDisplay() {
                this.zoomLevelDisplay.textContent = `${Math.round(this.scale * 100)}%`;
            }

            startDrag(e) {
                if (e.button !== 0) return; // åªå“åº”å·¦é”®
                this.isDragging = true;
                this.startX = e.clientX - this.translateX;
                this.startY = e.clientY - this.translateY;
                this.content.style.cursor = 'grabbing';
            }

            drag(e) {
                if (!this.isDragging) return;
                e.preventDefault();
                this.translateX = e.clientX - this.startX;
                this.translateY = e.clientY - this.startY;
                this.updateTransform();
            }

            endDrag() {
                this.isDragging = false;
                this.content.style.cursor = 'grab';
            }

            showHint() {
                this.hint.classList.add('show');
                setTimeout(() => {
                    this.hint.classList.remove('show');
                }, 3000);
            }

            download() {
                const img = this.content.querySelector('img');
                const svg = this.content.querySelector('svg');

                if (img) {
                    // ä¸‹è½½å›¾ç‰‡
                    const a = document.createElement('a');
                    a.href = img.src;
                    a.download = `image-${Date.now()}.png`;
                    a.click();
                } else if (svg) {
                    // ä¸‹è½½ SVG
                    const svgData = new XMLSerializer().serializeToString(svg);
                    const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `diagram-${Date.now()}.svg`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            }
        }

        // åˆå§‹åŒ–å…¨å±€å›¾ç‰‡æŸ¥çœ‹å™¨å®ä¾‹
        window.imageViewer = null;

        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.imageViewer = new ImageViewer();
        });
    </script>
</body>

</html>